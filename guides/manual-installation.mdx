---
title: Manual installation
---

import PagesCatchAllExample from "/snippets/examples/pages-catch-all.mdx"

The fastest way to get started with Makeswift on a new Next.js project is to follow the
[quickstart](/quickstart) guide. If you have an existing Next.js application
or want to set things up yourself, continue with the rest of this guide.

## System requirements

- [Node.js 18.17](https://nodejs.org/en) or a later version.
- macOS, Windows (including WSL), and Linux are supported.

## Geting started

<Steps>
  <Step title="Open your Next.js project">
    First, open your Next.js project. If you don't already have one, head over to
    the [Next.js](https://nextjs.org/docs/getting-started/installation)
    documentation to get one set up. If you do have one, please verify you are
    using [Next.js 12](https://nextjs.org/blog/next-12) or a later version.
  </Step>
  <Step title="Install dependencies">
  Install the `@makeswift/runtime` package. This package contains all of the necessary
  code to integrate Makeswift into your Next.js app.

```bash
npm install @makeswift/runtime
```

  </Step>
  <Step title="Add API key to environment variables">
  
Requesting data through the `Makeswift` client requires a site API key from Makeswift. In the Makeswift builder, go to **Settings > Host** and copy the API key for the site.

<Frame>
  <img src="/images/site-api-key.gif" alt="How to get the site API key" />
</Frame>

Once the API key is in your clipboard, open your [`.env.local`](https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables) file and paste the snippet below.

```sh
MAKESWIFT_SITE_API_KEY = paste-your-api-key-here
```

  </Step>
  <Step title="Add Makeswift runtime and client">
  
Create files for the Makeswift [runtime](/reference/runtime/constructor) and [client](/reference/client/constructor).

import RuntimeExample from "/snippets/examples/runtime.mdx"
import ClientExample from "/snippets/examples/client.mdx"

<CodeGroup>
  <RuntimeExample />
  <ClientExample />
</CodeGroup>

</Step>
  <Step title="Add the Makeswift API handler">
  
Similar to [NextAuth.js](https://next-auth.js.org/), Makeswift uses an API handler to communicate with your Next.js app. Create the file `pages/api/makeswift/[...makeswift].js`. It's important that the file has that exact name, excluding
the extension, which can be `ts` if you're using TypeScript.

import ApiHandlerExample from "/snippets/examples/api-handler.mdx"

<ApiHandlerExample />

This API route adds support for
[preview Mode](https://nextjs.org/docs/pages/building-your-application/configuring/preview-mode),
[on-demand revalidation](https://nextjs.org/docs/pages/building-your-application/data-fetching/incremental-static-regeneration#on-demand-revalidation),
and other features that make Makeswift work seamlessly with your Next.js app.

  </Step>
  <Step title="Add the Next.js plugin">
  
Next.js plugins are configured in the project's next.config.js file by wrapping `nextConfig`. The Makeswift Next.js plugin whitelists Makeswift image domains and sets up rewrites to enable preview mode in the Makeswift builder.

```js next.config.js
const withMakeswift = require("@makeswift/runtime/next/plugin")()

const nextConfig = {
  /* Your Next.js config... */
}

module.exports = withMakeswift(nextConfig)
```

  </Step>
  <Step title="Set up a custom Document">
  
Create a [custom Document](https://nextjs.org/docs/pages/building-your-application/routing/custom-document) named `_document.js` and export `Document` from `@makeswift/runtime/next`. The Makeswift custom Document handles styles during server-side rendering and using [Preview Mode](https://nextjs.org/docs/pages/building-your-application/configuring/preview-mode) when opening your pages in the Makeswift builder.

```js pages/_document.js
export { Document as default } from "@makeswift/runtime/next"
```

If you already have a `_document.js`, you can [extend the Document](/guides/extending-the-document) from `@makeswift/runtime/next` instead.

  </Step>
  <Step title="Register components with Makeswift">
  
Create a file for registered components called `makeswift/components.tsx`. In this example, only one component is registered. However, as you register more components, we recommend creating separate files for each component and rolling up the imports in the `makeswift/components.ts` file. Learn more about [registering components](/reference/runtime/register-component).

```tsx makeswift/components.tsx
import { ReactRuntime } from "@makeswift/runtime/react"
import { Style } from "@makeswift/runtime/controls"

function HelloWorld(props) {
  return <p {...props}>Hello, world!</p>
}

ReactRuntime.registerComponent(HelloWorld, {
  type: "hello-world",
  label: "Hello, world!",
  props: {
    className: Style(),
  },
})
```

  </Step>
  <Step title="Add a route for Makeswift pages">
  
Create an [optional catch-all route](https://nextjs.org/docs/pages/building-your-application/routing/dynamic-routes#optional-catch-all-segments) named `[[...path]].js`. You will use the catch-all route to fetch page snapshots from the `Makeswift` client and pass them to the [`Page`](/reference/components/page) component to render.

<PagesCatchAllExample />

**Important notes**:

1. If you already have an `index.js` file, you will need to name the file `[...path.js]` instead of `[[...path.js]]`. For more information about the differences between catch-all and optional catch-all segments, refer to the Next.js [Catch-all segments](https://nextjs.org/docs/pages/building-your-application/routing/dynamic-routes#catch-all-segments) documentation.

2. The filename defines the `path` param. For example, if the filename is `[[...slug]].js` instead of `[[...path]].js`, then the param name is `slug`. Because this is an optional catch-all route, there are no params when visiting the index (i.e., `/`) path. The `path` param defaults to an empty array.

3. [`fallback: 'blocking'`](https://nextjs.org/docs/pages/api-reference/functions/get-static-paths#fallback-blocking) is used here so that your Next.js app doesn't need to be re-deployed whenever a new Makeswift page is created.

With this setup, your pages will be rendered using
[incremental static regeneration](https://nextjs.org/docs/pages/building-your-application/data-fetching/incremental-static-regeneration).
A `revalidate` field isn't added to the returned value of `getStaticProps` because
Makeswift pages are automatically revalidated using
[on-demand revalidation](https://nextjs.org/basic-features/data-fetching/incremental-static-regeneration#on-demand-revalidation)
by leveraging the Makeswift API handler.

  </Step>
  
  <Step title="Start the local dev server">
  
Run the local development script. This will start the Next.js app at `http://localhost:3000`.

```bash
npm run dev
```

If port `3000` is already in use, Next.js will try port `3001`, then `3002`, and so forth until it finds an
unused port.

<Note>Take note of this port for the next step.</Note>

  </Step>
  <Step title="Add your app's URL to Makeswift">
  
Finally, open the Makeswift builder, navigate to **Settings > Host**, and add your app's URL. If you haven't changed anything in the example and the server is running on port `3000`, the app's URL should be
`http://localhost:3000`.

<Frame>
  <img src="/images/host-url.gif" alt="How to update the host url" />
</Frame>

When you're ready to deploy, set up a separate site and use your deployment URL
instead of `localhost`. You can keep this site for local development.

  </Step>
  <Step title="Start building">
  
Great job! You should be able to create a page in Makeswift and start dropping in registered
components from the left toolbar.

<Frame>
  <img src="/images/registered-components.png" alt="Registered components" />
</Frame>

</Step>
</Steps>
